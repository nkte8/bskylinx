# Skyshare 更新履歴

## 1.1.5

### Patch Changes

- **投稿時、ポストに言語のメタデータを付与するオプションを追加しました** 。
  - とりあえず日本語・English・中文・한국어に対応しました。
  - これはあくまで投稿に対してメタデータを含め、Feedなどに表示できるようにするための情報であり、今後の当サイトの多言語対応に関するロードマップとは関係ありません。
- **iOS16.4以前の端末で、Skyshareが一切動作をしなくなる問題を解消しました。**
  - 原因となった関数はversion 1.1.0から追加された外部URLの埋め込みを行うための二種の関数`getMeta.ts`および`getOgp.ts`でした。
  - 外部URLの埋め込みのため、埋め込み先へアクセスを行い、クライアント内でHTMLの構文解析を行うのですが、この処理にあたって正規表現を使用しており、**「肯定後読み」と呼ばれる処理`(?<=)`がiOS16.4以前では使えないという状況でした** 。
    - 参考: [Lookbehind in JS regular expressions | Can I use... Support tables for HTML5, CSS3, etc](https://caniuse.com/js-regexp-lookbehind)
  - そのため、正規表現から本処理を別の同等の処理に置き換えることで対処しました。
    - 参考: [Safariで後読み正規表現が使いたい時の諦め方](https://zenn.dev/videotouch/articles/f4b6f1ea803a27)
  - なお、上記の処理ではYoutube等特定のWebサイトのリンクカードの取得ができないためv1.2.0以降に予定しています。
  - **今回の問題解決にあたり [anon氏(@anon5r.com)](https://bsky.app/profile/anon5r.com)、[So Asano氏(@so-asano.com)](https://bsky.app/profile/so-asano.com) の情報提供により、エラー箇所に当たりを付けることができました** 。
    - また、**これまで最新版しか検証ができなかった当サイトの開発環境が更新され、ブラウザの下位互換対応が可能になりました** 。
    - **お二人には感謝してもしきれません。心よりの感謝を申し上げます** 。
- その他、UIを調整しました。
  - 高度な設定としていた項目を展開し、通常状態で表示するようにしました。

## 1.1.4

### Patch Changes

- 入力文字数がXの上限を超えた際、文字数表示箇所に警告表示を行うようにしました。
  - 141文字以上の入力を行うと、Blueskyへは投稿可能ですがTwitterは投稿不可なため、アプリ起動またはポップアップ後に自力で編集していただく対応とさせていただきます。
- URL埋め込みについて、Youtubeなど、一部のサイトにまだ対応できていないことをQAへ追記しました。
  - 他サイトと構造や状況が異なり、主にCORSが原因でフロントエンド側から情報の取得ができないサイトについては、バックエンドを交えた情報取得が必須になり、パッチリリースのレベルでは対応できないため、現在の仕様としては不具合ではなく不可な状況です。アップデートをお待ちください。
- トップページにアプリ化に対応している旨を記載しました。

## 1.1.3

### Patch Changes

- Xへの投稿の際にURLの挿入位置を変更しないようにしました。
  - Xへの投稿で、intentを用いてURLを投稿する場合、URLクエリに`&url`パラメータを指定すると通説では言われていましたが、本文に直接記載した場合も正しく動作したため、URLクエリを廃止し、Blueskyと同様の箇所にURLを差し込めるように変更しました。
- ヘッダメニューを非表示にする長さを長く設定し、メニューの折り返しが発生しないよう修正しました。
- Xでポストするボタンを押した後表示を変更し、ポストしたかどうかを一目でわかるように改修しました。
  - あくまでボタンを押した場合に表示を変更しています。Xを自動で開くオプションをONにしている場合の、ボタンによらないXのアプリ起動（ポップアップ）については、ボタンの表示は変わりません。

## 1.1.2

### Patch Changes

- Xへの投稿プレビュー画面にて、改行処理が正常でない問題を修正しました。
  - Reactが取り扱うstring型を`JSX.Element`に展開する際、改行が削除されてしまっていたため、エスケープして正しく表示するよう修正しました。

## 1.1.1

### Patch Changes

- ローディングにエラーハンドリングを追加しました。
  - いくつかの環境でローディングが終わらず、投稿画面が開けないという症状の報告を受けています。
  - 原因が不明なため、エラーハンドリングを追加し、ステータスメッセージを出力するよう改修しました。
    - **開発者環境では再現困難な状況です。引き続きフィードバックのご協力をお願いします。**
- OGPカードの生成とリンクカード埋め込みの概念を切り離し、「OGPを生成しない(埋め込みURL有効化)」から **「Xへの投稿画像は自身で添付する」** へオプション名を変更しました。
  - **「Xへの投稿画像は自身で添付する」オプションのON/OFFにかかわらず、画像が添付されていない場合は外部URLのリンクカードの埋め込みを試みます** 。
    - 複数のURLが記載されている場合の動作は、最も最後に検出したURLを用います（v1.1.0と同様の動作）
  - **「Xへの投稿画像は自身で添付する」オプションのON/OFFにかかわらず、 画像が添付されている場合は外部URLのリンクカードの埋め込みを試みません。**
    - 画像の添付とURLの付与は共存可能ですが、画像の添付とリンクカードの埋め込みは共存できないためです。
  - **「Xへの投稿画像は自身で添付する」オプションがONであり、画像が添付されている場合、OGPジェネレータを実施しません。**
    - Blueskyへは画像付きポストが投稿されます。このオプションをONにした場合は、Twitterへの画像添付は手動にてお願いします。
- 「キャンセル」ボタンを「下書きを消す」に改善しました。

## 1.1.0

### Minor Changes

- **OGPを生成しないオプションを追加しました！**
  - 待たせたな[@uitemasen.bsky.social](https://bsky.app/profile/uitemasen.bsky.social)とその他クリエイター！自分で画像を貼るがよいぞ！
  - 高度な設定として、画像からOGPカードが付与されたページのURLを停止するオプションを追加しました。
- **Blueskyへの投稿に対して、(外部URL含む)リンクカードの埋め込みが行われるようになりました！**
  - 待たせたな[@chinjuh.bsky.social](https://bsky.app/profile/chinjuh.bsky.social)とその他クリエイター！好きなだけ外部サービスを埋め込むがいい！
  - **この機能はOGPを生成しないオプションと入れ替わりで有効になります。OGPジェネレータと同時に使用することはできません。**
  - 文章で最も最後に検出されたURLをOGPカードに用いますので、複数URLを記載した投稿を予定されているユーザは挙動についてご注意ください。
- **投稿画面を大きく改善しました。**
  - [@tooon.bsky.social](https://bsky.app/profile/tooon.bsky.social)氏、改善案をありがとう！
  - UI/UXの改善として、投稿画面自体をBlueskyに寄せた作りにし、**Xへポストについては投稿後に画面遷移するように改善しました** 。
  - Xへポストを行う画面にプレビュー機能を設けました。ただし、当サイトから直接ポストを行うわけではないため、あくまで目安として活用ください。
- **Xへのポストをより簡略化するオプションを追加しました。**
  - Xへポストを行う画面（プレビュー画面）を表示すると同時に直接Xへのポップアップ（またはアプリの起動）が行われます。
  - **ブラウザへ事前にポップアップの許可をお願いします。拒否した場合、オプションをオンにしていてもオフの場合と同じ挙動になります。**

### Patch Changes

- OGPページの生成中にXへポストボタンが押せるようになってしまう不具合を修正しました。

## 1.0.11

### Patch Changes

- Firefoxにて文字数カウントが表示されない問題の対処および、textareaの入力制限が想定より小さい状態となっていた問題の対処
  - textareaエレメントは300字の制限を設けていましたが、絵文字の入力を行った際、正しくエレメントが文字数を認識していませんでした。
    - 以上より、文字数の制限はエレメントではなく、投稿プロセスの中で実施する方針で対処しました。
  - [firefoxでは`Intl.Segmenter`が対応されておらず、絵文字の文字数を正常に計上できません](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%83%BC%E3%81%AE%E4%BA%92%E6%8F%9B%E6%80%A7)。`Intl.Segmenter`はfirefoxにおいてもv125に対応予定とされているため、**本バージョンに至るまではfirefoxは非推奨ブラウザとさせていただきます**。
- Twitterと混同しないよう、当サイト上で投稿を共有する先がXであることを修正しました。
- 画像投稿時のエラーハンドリング誤りを修正しました。
  - 画像添付でのポスト時、`Unexpected Error`と出力されていた原因に対して対処しました。
  - ~~解決したのはエラーハンドリングのみであり、一部の画像の投稿に関してまだ何らかのエラー原因があると思われます。これについては根本原因について調査・対応中です。~~
  - **追記: 以上により特定環境下で発生していた画像を含む投稿ができない不具合が解消されました。**
    - 画像を格納する変数に対しての項目の問い合わせ箇所 `value.blob.ref?.$link` としていた箇所が、環境によるJavascriptの厳格度の違いで、`TypeError`となる環境とそうではない環境が存在していたと考えられます。
    - これを `uploadBlob` 関数のエラー時の戻り値である `value?.error` を参照するように修正したことで、 `TypeError` が発生しなくなりました。
  - 問題の発見、および **三日間にも渡るテスト作業に付き合ってくださった[@gapashu0603.bsky.social](https://bsky.app/profile/gapashu0603.bsky.social)氏には盛大な感謝を！** ありがとうございました！！
- ログアウトボタンのUIが崩れていたため修正しました。

## 1.0.10

### Patch Changes

- Unexpected Errorの報告事例が相次ぐため、エラーハンドリングを強化しました。
  - これまでUnexpected Errorだった内容が、どのAPIが・どういった内容のエラーなのかをステータスメッセージとして詳細に報告するようになります。フィードバックのご協力に感謝します！
- Statusメッセージの表示を改善しました。
  - spanタグではなく、divタグに置き換え、改行した際も見た目が崩れないように設定しました。

## 1.0.9

### Patch Changes

- Changelogをページ化実施しました。
- Changeset導入によるバージョン管理を採用しました。Changelogが自動で作られて、便利。
- ログイン時、右上のログアウトボタンが押せなくなっていた不具合を修正しました。
  - 原因はDisableフラグを逆に指定していました。つまりログアウト時に有効になり、ログイン時に使えないという、矛盾した設定内容となっていました。
- 各ページの開発者アカウントのURLを修正しました。新handleは[nekono.dev](https://bsky.app/profile/nekono.dev)です。
- QAへ項目を追加しました。
- ログイン画面のhandleおよびpasswordフォームに初期値を追加し、入力内容をわかりやすくしました。
- その他tailwindCSS関連の設定値を整備しました。
  - 具体的には本Changelogページの整形のため、markdown-itによりHTML化、これに対してtailwindCSSがスタイルを適応できるよう、tailwind-variantsの一部のコードを[tailwindCSSの機能（adding-base-style）](https://tailwindcss.com/docs/plugins#adding-base-styles)に置き換えました。

## 1.0.8

### Patch Changes

- 末尾に改行コードを含むほとんどのメンション・リンクが投稿できない不具合を修正しました。
  - 原因は区切り文字で、1.0.7以前ではスペース文字を区切り文字として設定していましたが、改行文字は通常の文字種と同様に扱ってしまっていました。改行コードは明らかにURLとURLではない箇所を分割するため、区切り文字として判定するように修正しました。
  - 他にも区切り文字はあるかもしれませんが、いったんはBluesky公式が準じているだろう、上記の区切り文字（スペースまたは改行コード）を対象とします。発見ありがとうございました！[@tooon.bsky.social](https://bsky.app/profile/tooon.bsky.social)氏！

## 1.0.6

### Patch Changes

- 誤解を招く表現だったため、トップページの文言を少し変えました
- Q&Aページを作成しました。

## 1.0.5

### Patch Changes

- 日本語を含む文章にリンクまたはメンションを含む場合に、正常にリンクされない不具合を修正しました。
  - 原因はcreateRecordの際に、リンクを含む場合はRecordのfacetsとしてテキスト中のどこからどこまでを数値で指定してあげる必要があり、この数値の単位が文字ではなく、文字のバイト数を示していました。
  - これにより日本語は1文字3バイト換算にもかかわらず、処理上では1バイトとして扱っていたため、これを修正し、範囲ずれが起こらないようにしました。発見ありがとうございました！[@cpro.bsky.social](https://bsky.app/profile/cpro.bsky.social)氏！
- これより前までのPatch Changesは記録していませんでした...

## 1.0.0

### Major Changes

- 初リリース！よろしくお願いいたします。
